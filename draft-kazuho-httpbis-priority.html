<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>Extensible Prioritization Scheme for HTTP</title>

  
<style type="text/css">/*<![CDATA[*/

body {
  font: 16px "Helvetica Neue","Open Sans",Helvetica,Calibri,sans-serif;
  color: #333;
  font-size-adjust: 0.5;
  line-height: 24px;
  margin: 75px auto;
  max-width: 624px;
  padding: 0 5px;
}

.title, .filename, h1, h2, h3, h4, h5 {
  font: 16px "Roboto Condensed","Helvetica Neue","Open Sans",Helvetica,Calibri,sans-serif;
  font-size-adjust: 0.5;
  font-weight: bold;
  color: #333;
  line-height: 100%;
  margin: 1.2em 0 0.3em;
}
.title, #rfc\.title h1 { font-size: 32px; }
h1, section h1, h2, section h2, section h3, nav h2 { font-size: 20px; }
h3, section h4, h4, section h5 { font-size: 16px; }
h1 a[href], h2 a[href], h3 a[href], h4 a[href] {
  color: #333;
}

table {
  margin-left: 0em;
  border-collapse: collapse;
}
th {
  text-align: left;
  border-bottom: 2px solid #ddd;
}
td {
  border-top: 1px solid #ddd;
  vertical-align: top;
}
tr:nth-child(2n+1) > td,
tr:nth-child(2n+1) > th {
  background-color: #f9f9f9;
}
td.reference {
  max-width: 200px;
  border-top: none;
  padding-right: 1em;
}
.right {
  text-align: right;
}


table.header, table#rfc\.headerblock {
  width: 100%;
}
table.header td, table#rfc\.headerblock td {
  border: none;
  background-color: transparent;
  color: black;
  padding: 0;
}
.filename {
  display: block;
  color: rgb(119, 119, 119);
  font-size: 20px;
  font-weight: normal;
  line-height: 100%;
  margin: 10px 0 32px;
}
#rfc\.abstract+p, #rfc\.abstract+p code, #rfc\.abstract+p samp, #rfc\.abstract+p tt {
  font-size: 20px;
  line-height: 28px;
}

samp, tt, code, pre, span.tt {
  font-size: 13.5px;
  font-family: Consolas, monospace;
  font-size-adjust: none;
}
pre {
  background-color: #eee;
  border: 1px solid #ddd;
  overflow-x: auto;
  padding: 5px;
  margin: 5px;
}
.figure, caption {
  font-style: italic;
  margin: 0 1.5em;
  text-align: left;
}

address {
  margin: 16px 2px;
  line-height: 20px;
}
.vcard {
  font-style: normal;
}
.vcardline {
  display: block;
}
.vcardline .fn, address b {
  font-weight: normal;
}
.vcardline .hidden {
  display: none;
}

dl {
  margin-left: 1em;
}
dl.dl-horizontal: {
  margin-left: 0;
}
dl > dt {
  float: left;
  margin-right: 1em;
}
dl.nohang > dt {
  float: none;
}
dl > dd {
  margin-bottom: .5em;
}
dl.compact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}
ul.empty {
  list-style-type: none;
}
ul.empty li {
  margin-top: .5em;
}

hr {
  border: 0;
  border-top: 1px solid #eee;
}
hr.noprint {
  display: none;
}

a {
  text-decoration: none;
}
a[href] {
  color: #2a6496;
}
a[href]:hover {
  background-color: #eee;
}

p, ol, ul, li {
  padding: 0;
}
p {
  margin: 0.5em 0;
}
ol, ul {
  margin: 0.2em 0 0.2em 2em;
}
li {
  margin: 0.2em 0;
}
address {
  font-style: normal;
}

ul.toc ul {
  margin: 0 0 0 2em;
}
ul.toc li {
  list-style: none;
  margin: 0;
}

@media screen and (min-width: 924px) {
  body {
    padding-right: 350px;
  }
  body>ul.toc, body>#rfc\.toc {
    position: fixed;
    bottom: 0;
    right: 0;
    right: calc(50vw - 500px);
    width: 300px;
    z-index: 1;
    overflow: auto;
    overscroll-behavior: contain;
  }
  body>#rfc\.toc {
    top: 55px;
  }
  body>ul.toc {
    top: 100px;
  }

  ul.toc {
    margin: 0 0 0 4px;
    font-size: 12px;
    line-height: 20px;
  }
  ul.toc ul {
    margin-left: 1.2em;
  }
}

.github-fork-ribbon-wrapper {
  display: none;
}
@media screen and (min-width: 800px) {
  /* "Fork me on GitHub" CSS ribbon based on
   * https://github.com/simonwhitaker/github-fork-ribbon-css
   */
  .github-fork-ribbon {
    position: absolute;
    padding: 2px 0;
    background-color: #a00;
    background-image: linear-gradient(to bottom, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.15));
    box-shadow: 0 2px 3px 0 rgba(0, 0, 0, 0.5);
    font: 700 12px "Helvetica Neue", Helvetica, Arial, sans-serif;

    pointer-events: auto;

    top: 38px;
    right: -45px;

    transform: rotate(45deg);
  }

  .github-fork-ribbon a[href],
  .github-fork-ribbon a[href]:hover {
    color: #fff;
    background-color: transparent;
    text-decoration: none;
    text-shadow: 0 -1px rgba(0, 0, 0, 0.5);
    text-align: center;

    width: 190px;
    line-height: 18px;

    display: inline-block;
    padding: 2px 0;

    border: 1.5px dotted #fff;
    border-color: rgba(255, 255, 255, 0.6);
  }

  .github-fork-ribbon-wrapper {
    display: block;
    width: 130px;
    height: 130px;
    position: absolute;
    overflow: hidden;
    top: 0; right: 0;
    z-index: 2;
    pointer-events: none;
  }
}
@media screen and (min-width: 1000px) {
  .github-fork-ribbon-wrapper {
    position: fixed;
  }
/*]]>*/</style>
<meta name="viewport" content="initial-scale=1.0">


  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction">
<link href="#rfc.section.1.1" rel="Chapter" title="1.1 Notational Conventions">
<link href="#rfc.section.2" rel="Chapter" title="2 The Priority HTTP Header Field">
<link href="#rfc.section.2.1" rel="Chapter" title="2.1 urgency">
<link href="#rfc.section.2.1.1" rel="Chapter" title="2.1.1 prerequisite">
<link href="#rfc.section.2.1.2" rel="Chapter" title="2.1.2 default">
<link href="#rfc.section.2.1.3" rel="Chapter" title="2.1.3 supplementary">
<link href="#rfc.section.2.1.4" rel="Chapter" title="2.1.4 background">
<link href="#rfc.section.2.2" rel="Chapter" title="2.2 progressive">
<link href="#rfc.section.3" rel="Chapter" title="3 Merging Client- and Server-Driven Parameters">
<link href="#rfc.section.4" rel="Chapter" title="4 Coexistence with HTTP/2 Priorities">
<link href="#rfc.section.4.1" rel="Chapter" title="4.1 The SETTINGS_HEADER_BASED_PRIORITY SETTINGS Parameter">
<link href="#rfc.section.5" rel="Chapter" title="5 Considerations">
<link href="#rfc.section.5.1" rel="Chapter" title="5.1 Why use an End-to-End Header Field?">
<link href="#rfc.section.5.2" rel="Chapter" title="5.2 Why do Urgencies Have Meanings?">
<link href="#rfc.section.5.3" rel="Chapter" title="5.3 Reprioritization">
<link href="#rfc.section.6" rel="Chapter" title="6 Security Considerations">
<link href="#rfc.section.7" rel="Chapter" title="7 IANA Considerations">
<link href="#rfc.references" rel="Chapter" title="8 References">
<link href="#rfc.references.1" rel="Chapter" title="8.1 Normative References">
<link href="#rfc.references.2" rel="Chapter" title="8.2 Informative References">
<link href="#rfc.appendix.A" rel="Chapter" title="A Acknowledgements">
<link href="#rfc.appendix.B" rel="Chapter" title="B Change Log">
<link href="#rfc.appendix.B.1" rel="Chapter" title="B.1 Since draft-kazuho-httpbis-priority-02">
<link href="#rfc.appendix.B.2" rel="Chapter" title="B.2 Since draft-kazuho-httpbis-priority-01">
<link href="#rfc.appendix.B.3" rel="Chapter" title="B.3 Since draft-kazuho-httpbis-priority-00">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content="xml2rfc version 2.23.1 - https://tools.ietf.org/tools/xml2rfc" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />

  <meta name="dct.creator" content="Oku, K. and L. Pardue" />
  <meta name="dct.identifier" content="urn:ietf:id:draft-kazuho-httpbis-priority-latest" />
  <meta name="dct.issued" scheme="ISO8601" content="2019-10-31" />
  <meta name="dct.abstract" content="This document describes a scheme for prioritizing the delivery of HTTP responses. The prioritization scheme expresses absolute values for each HTTP response, rather than the relative precedence between a group of HTTP responses.This document defines the Priority header field for communicating the initial priority in an HTTP version-independent manner, as well as HTTP/2 and HTTP/3 frames for reprioritizing the responses. These share a common format structure that is designed to provide future extensibility." />
  <meta name="description" content="This document describes a scheme for prioritizing the delivery of HTTP responses. The prioritization scheme expresses absolute values for each HTTP response, rather than the relative precedence between a group of HTTP responses.This document defines the Priority header field for communicating the initial priority in an HTTP version-independent manner, as well as HTTP/2 and HTTP/3 frames for reprioritizing the responses. These share a common format structure that is designed to provide future extensibility." />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left">HTTP</td>
<td class="right">K. Oku</td>
</tr>
<tr>
<td class="left">Internet-Draft</td>
<td class="right">Fastly</td>
</tr>
<tr>
<td class="left">Intended status: Standards Track</td>
<td class="right">L. Pardue</td>
</tr>
<tr>
<td class="left">Expires: May 3, 2020</td>
<td class="right">Cloudflare</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">October 31, 2019</td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">Extensible Prioritization Scheme for HTTP<br />
  <span class="filename">draft-kazuho-httpbis-priority-latest</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>This document describes a scheme for prioritizing the delivery of HTTP responses. The prioritization scheme expresses absolute values for each HTTP response, rather than the relative precedence between a group of HTTP responses.</p>
<p>This document defines the Priority header field for communicating the initial priority in an HTTP version-independent manner, as well as HTTP/2 and HTTP/3 frames for reprioritizing the responses. These share a common format structure that is designed to provide future extensibility.</p>
<h1 id="rfc.status"><a href="#rfc.status">Status of This Memo</a></h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet-Drafts is at https://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on May 3, 2020.</p>
<h1 id="rfc.copyrightnotice"><a href="#rfc.copyrightnotice">Copyright Notice</a></h1>
<p>Copyright (c) 2019 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (https://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a>
</li>
<ul><li>1.1.   <a href="#rfc.section.1.1">Notational Conventions</a>
</li>
</ul><li>2.   <a href="#rfc.section.2">The Priority HTTP Header Field</a>
</li>
<ul><li>2.1.   <a href="#rfc.section.2.1">urgency</a>
</li>
<ul><li>2.1.1.   <a href="#rfc.section.2.1.1">prerequisite</a>
</li>
<li>2.1.2.   <a href="#rfc.section.2.1.2">default</a>
</li>
<li>2.1.3.   <a href="#rfc.section.2.1.3">supplementary</a>
</li>
<li>2.1.4.   <a href="#rfc.section.2.1.4">background</a>
</li>
</ul><li>2.2.   <a href="#rfc.section.2.2">progressive</a>
</li>
</ul><li>3.   <a href="#rfc.section.3">Merging Client- and Server-Driven Parameters</a>
</li>
<li>4.   <a href="#rfc.section.4">Coexistence with HTTP/2 Priorities</a>
</li>
<ul><li>4.1.   <a href="#rfc.section.4.1">The SETTINGS_HEADER_BASED_PRIORITY SETTINGS Parameter</a>
</li>
</ul><li>5.   <a href="#rfc.section.5">Considerations</a>
</li>
<ul><li>5.1.   <a href="#rfc.section.5.1">Why use an End-to-End Header Field?</a>
</li>
<li>5.2.   <a href="#rfc.section.5.2">Why do Urgencies Have Meanings?</a>
</li>
<li>5.3.   <a href="#rfc.section.5.3">Reprioritization</a>
</li>
</ul><li>6.   <a href="#rfc.section.6">Security Considerations</a>
</li>
<li>7.   <a href="#rfc.section.7">IANA Considerations</a>
</li>
<li>8.   <a href="#rfc.references">References</a>
</li>
<ul><li>8.1.   <a href="#rfc.references.1">Normative References</a>
</li>
<li>8.2.   <a href="#rfc.references.2">Informative References</a>
</li>
</ul><li>Appendix A.   <a href="#rfc.appendix.A">Acknowledgements</a>
</li>
<li>Appendix B.   <a href="#rfc.appendix.B">Change Log</a>
</li>
<ul><li>B.1.   <a href="#rfc.appendix.B.1">Since draft-kazuho-httpbis-priority-02</a>
</li>
<li>B.2.   <a href="#rfc.appendix.B.2">Since draft-kazuho-httpbis-priority-01</a>
</li>
<li>B.3.   <a href="#rfc.appendix.B.3">Since draft-kazuho-httpbis-priority-00</a>
</li>
</ul><li><a href="#rfc.authors">Authors' Addresses</a>
</li>


  </ul>

  <h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> <a href="#introduction" id="introduction">Introduction</a>
</h1>
<p id="rfc.section.1.p.1">It is common for an HTTP (<a href="#RFC7230" class="xref">[RFC7230]</a>) resource representation to have relationships to one or more other resources.  Clients will often discover these relationships while processing a retrieved representation, leading to further retrieval requests.  Meanwhile, the nature of the relationship determines whether the client is blocked from continuing to process locally available resources.  For example, visual rendering of an HTML document could be blocked by the retrieval of a CSS file that the document refers to.  In contrast, inline images do not block rendering and get drawn progressively as the chunks of the images arrive.</p>
<p id="rfc.section.1.p.2">To provide meaningful representation of a document at the earliest moment, it is important for an HTTP server to prioritize the HTTP responses, or the chunks of those HTTP responses, that it sends.</p>
<p id="rfc.section.1.p.3">HTTP/2 (<a href="#RFC7540" class="xref">[RFC7540]</a>) provides such a prioritization scheme. A client sends a series of PRIORITY frames to communicate to the server a &#8220;priority tree&#8221;; this represents the client&#8217;s preferred ordering and weighted distribution of the bandwidth among the HTTP responses.  However, the design has shortcomings:</p>
<p></p>

<ul>
<li>Its complexity has led to varying levels of support by HTTP/2 clients and servers.</li>
<li>It is hard to coordinate with server-driven prioritization.  For example, a server, with knowledge of the document structure, might want to prioritize the delivery of images that are critical to user experience above other images, but below the CSS files.  But with the HTTP/2 prioritization scheme, it is impossible for the server to determine how such images should be prioritized against other responses that use the client-driven prioritization tree, because every client builds the HTTP/2 prioritization tree in a different way.</li>
<li>It does not define a method that can be used by a server to express the priority of a response.  Without such a method, intermediaries cannot coordinate client-driven and server-driven priorities.</li>
<li>The design cannot be ported cleanly to HTTP/3 (<a href="#I-D.ietf-quic-http" class="xref">[I-D.ietf-quic-http]</a>).  One of the primary goals of HTTP/3 is to minimize head-of-line blocking.  Transmitting the evolving representation of a &#8220;prioritization tree&#8221; from the client to the server requires head-of-line blocking.</li>
</ul>
<p id="rfc.section.1.p.5">Based on these observations, this document defines the Priority HTTP header field that can be used by both the client and the server to specify the precedence of HTTP responses in a standardized, extensible, protocol-version- independent, end-to-end format. This header-based prioritization scheme can act as a substitute for the HTTP/2 frame-based prioritization scheme (see <a href="#coexistence" class="xref">Section 4</a>).</p>
<h1 id="rfc.section.1.1">
<a href="#rfc.section.1.1">1.1.</a> <a href="#notational-conventions" id="notational-conventions">Notational Conventions</a>
</h1>
<p id="rfc.section.1.1.p.1">The key words &#8220;MUST&#8221;, &#8220;MUST NOT&#8221;, &#8220;REQUIRED&#8221;, &#8220;SHALL&#8221;, &#8220;SHALL NOT&#8221;, &#8220;SHOULD&#8221;, &#8220;SHOULD NOT&#8221;, &#8220;RECOMMENDED&#8221;, &#8220;MAY&#8221;, and &#8220;OPTIONAL&#8221; in this document are to be interpreted as described in <a href="#RFC2119" class="xref">[RFC2119]</a>.</p>
<p id="rfc.section.1.1.p.2">The terms sh-token and sh-boolean are imported from <a href="#STRUCTURED-HEADERS" class="xref">[STRUCTURED-HEADERS]</a>.</p>
<p id="rfc.section.1.1.p.3">Example HTTP requests and responses use the HTTP/2-style formatting from <a href="#RFC7540" class="xref">[RFC7540]</a>.</p>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> <a href="#the-priority-http-header-field" id="the-priority-http-header-field">The Priority HTTP Header Field</a>
</h1>
<p id="rfc.section.2.p.1">The Priority HTTP header field can appear in requests and responses. A client uses it to specify the priority of the response. A server uses it to inform the client that the priority was overwritten. An intermediary can use the Priority information from client requests and server responses to correct or amend the precedence to suit it (see <a href="#merging" class="xref">Section 3</a>).</p>
<p id="rfc.section.2.p.2">The value of the Priority header field is a Structured Headers Dictionary (<a href="#STRUCTURED-HEADERS" class="xref">[STRUCTURED-HEADERS]</a>). Each dictionary member represents a parameter of the Priority header field. This document defines the <samp>urgency</samp> and <samp>progressive</samp> parameters. Values of these parameters MUST always be present. When any of the defined parameters are omitted, or if the Priority header field is not used, their default values SHOULD be applied.</p>
<p id="rfc.section.2.p.3">Unknown parameters MUST be ignored.</p>
<h1 id="rfc.section.2.1">
<a href="#rfc.section.2.1">2.1.</a> <a href="#urgency" id="urgency">urgency</a>
</h1>
<p id="rfc.section.2.1.p.1">The <samp>urgency</samp> parameter takes an integer between -1 and 6 as shown below:</p>
<div id="rfc.table.1"></div>
<div id="urgencies"></div>
<table cellpadding="3" cellspacing="0" class="tt full center">
<caption>Urgencies</caption>
<thead><tr>
<th class="right">Urgency</th>
<th class="left">Definition</th>
</tr></thead>
<tbody>
<tr>
<td class="right">-1</td>
<td class="left">prerequisite (<a href="#prerequisite" class="xref">Section 2.1.1</a>)</td>
</tr>
<tr>
<td class="right">0</td>
<td class="left">default (<a href="#default" class="xref">Section 2.1.2</a>)</td>
</tr>
<tr>
<td class="right">between 1 and 5</td>
<td class="left">supplementary (<a href="#supplementary" class="xref">Section 2.1.3</a>)</td>
</tr>
<tr>
<td class="right">6</td>
<td class="left">background (<a href="#background" class="xref">Section 2.1.4</a>)</td>
</tr>
</tbody>
</table>
<p id="rfc.section.2.1.p.2">The value is encoded as an sh-integer.  The default value is zero.</p>
<p id="rfc.section.2.1.p.3">A server SHOULD transmit HTTP responses in the order of their urgency values.  The lower the value, the higher the precedence.</p>
<p id="rfc.section.2.1.p.4">The following example shows a request for a CSS file with the urgency set to <samp>-1</samp>:</p>
<pre>
:method = GET
:scheme = https
:authority = example.net
:path = /style.css
priority = urgency=-1
</pre>
<p id="rfc.section.2.1.p.5">The definition of the urgencies and their expected use-case are described below.  Endpoints SHOULD respect the definition of the values when assigning urgencies.</p>
<h1 id="rfc.section.2.1.1">
<a href="#rfc.section.2.1.1">2.1.1.</a> <a href="#prerequisite" id="prerequisite">prerequisite</a>
</h1>
<p id="rfc.section.2.1.1.p.1">The prerequisite urgency (value -1) indicates that the response prevents other responses with an urgency of prerequisite or default from being used.</p>
<p id="rfc.section.2.1.1.p.2">For example, use of an external stylesheet can block a web browser from rendering the HTML. In such case, the stylesheet is given the prerequisite urgency.</p>
<h1 id="rfc.section.2.1.2">
<a href="#rfc.section.2.1.2">2.1.2.</a> <a href="#default" id="default">default</a>
</h1>
<p id="rfc.section.2.1.2.p.1">The default urgency (value 0) indicates a response that is to be used as it is delivered to the client, but one that does not block other responses from being used.</p>
<p id="rfc.section.2.1.2.p.2">For example, when a user using a web browser navigates to a new HTML document, the request for that HTML is given the default urgency.  When that HTML document uses a custom font, the request for that custom font SHOULD also be given the default urgency.  This is because the availability of the custom font is likely a precondition for the user to use that portion of the HTML document, which is to be rendered by that font.</p>
<h1 id="rfc.section.2.1.3">
<a href="#rfc.section.2.1.3">2.1.3.</a> <a href="#supplementary" id="supplementary">supplementary</a>
</h1>
<p id="rfc.section.2.1.3.p.1">The supplementary urgency indicates a response that is helpful to the client using a composition of responses, even though the response itself is not mandatory for using those responses.</p>
<p id="rfc.section.2.1.3.p.2">For example, inline images (i.e., images being fetched and displayed as part of the document) are visually important elements of an HTML document.  As such, users will typically not be prevented from using the document, at least to some degree, before any or all of these images are loaded.  Display of those images are thus considered to be an improvement for visual clients rather than a prerequisite for all user agents.  Therefore, such images will be given the supplementary urgency.</p>
<p id="rfc.section.2.1.3.p.3">Values between 1 and 5 are used to represent this urgency, to provide flexibility to the endpoints for giving some responses more or less precedence than others that belong to the supplementary group. <a href="#merging" class="xref">Section 3</a> explains how these values might be used.</p>
<p id="rfc.section.2.1.3.p.4">Clients SHOULD NOT use values 1 and 5.  Servers MAY use these values to prioritize a response above or below other supplementary responses.</p>
<p id="rfc.section.2.1.3.p.5">Clients MAY use values 2 to indicate that a request is given relatively high priority, or 4 to indicate relatively low priority, within the supplementary urgency group.</p>
<p id="rfc.section.2.1.3.p.6">For example, an image certain to be visible at the top of the page, might be assigned a value of 2 instead of 3, as it will have a high visual impact for the user.  Conversely, an asynchronously loaded JavaScript file might be assigned an urgency value of 4, as it is less likely to have a visual impact.</p>
<p id="rfc.section.2.1.3.p.7">When none of the considerations above is applicable, the value of 3 SHOULD be used.</p>
<h1 id="rfc.section.2.1.4">
<a href="#rfc.section.2.1.4">2.1.4.</a> <a href="#background" id="background">background</a>
</h1>
<p id="rfc.section.2.1.4.p.1">The background urgency (value 6) is used for responses of which the delivery can be postponed without having an impact on using other responses.</p>
<p id="rfc.section.2.1.4.p.2">As an example, the download of a large file in a web browser would be assigned the background urgency so it would not impact further page loads on the same connection.</p>
<h1 id="rfc.section.2.2">
<a href="#rfc.section.2.2">2.2.</a> <a href="#progressive" id="progressive">progressive</a>
</h1>
<p id="rfc.section.2.2.p.1">The <samp>progressive</samp> parameter takes an sh-boolean as the value that indicates if a response can be processed progressively, i.e. provide some meaningful output as chunks of the response arrive.</p>
<p id="rfc.section.2.2.p.2">The default value of the <samp>progressive</samp> parameter is <samp>0</samp>.</p>
<p id="rfc.section.2.2.p.3">A server SHOULD distribute the bandwidth of a connection between progressive responses that share the same urgency.</p>
<p id="rfc.section.2.2.p.4">A server SHOULD transmit non-progressive responses one by one, preferably in the order the requests were generated.  Doing so maximizes the chance of the client making progress in using the composition of the HTTP responses at the earliest moment.</p>
<p id="rfc.section.2.2.p.5">The following example shows a request for a JPEG file with the urgency parameter set to <samp>3</samp> and the progressive parameter set to <samp>1</samp>.</p>
<pre>
:method = GET
:scheme = https
:authority = example.net
:path = /image.jpg
priority = urgency=3, progressive=?1
</pre>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> <a href="#merging" id="merging">Merging Client- and Server-Driven Parameters</a>
</h1>
<p id="rfc.section.3.p.1">It is not always the case that the client has the best understanding of how the HTTP responses deserve to be prioritized.  For example, use of an HTML document might depend heavily on one of the inline images.  Existence of such dependencies is typically best known to the server.</p>
<p id="rfc.section.3.p.2">By using the &#8220;Priority&#8221; response header, a server can override the prioritization hints provided by the client.  When used, the parameters found in the response header field overrides those specified by the client.</p>
<p id="rfc.section.3.p.3">For example, when the client sends an HTTP request with</p>
<pre>
:method = GET
:scheme = https
:authority = example.net
:path = /menu.png
priority = urgency=3, progressive=?1
</pre>
<p id="rfc.section.3.p.4">and the origin responds with</p>
<pre>
:status = 200
content-type = image/png
priority = urgency=1
</pre>
<p id="rfc.section.3.p.5">the intermediary&#8217;s understanding of the urgency is promoted from <samp>3</samp> to <samp>1</samp>, because the server-provided value overrides the value provided by the client.  The progressiveness continues to be <samp>1</samp>, the value specified by the client, as the server did not specify the <samp>progressive</samp> parameter.</p>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> <a href="#coexistence" id="coexistence">Coexistence with HTTP/2 Priorities</a>
</h1>
<p id="rfc.section.4.p.1">Standard HTTP/2 (<a href="#RFC7540" class="xref">[RFC7540]</a>) endpoints use frame-based prioritization, whereby a client sends priority information in dedicated fields present in HEADERS and PRIORITY frames. A client might instead choose to use header-based prioritization as specified in this document.</p>
<h1 id="rfc.section.4.1">
<a href="#rfc.section.4.1">4.1.</a> <a href="#the-settingsheaderbasedpriority-settings-parameter" id="the-settingsheaderbasedpriority-settings-parameter">The SETTINGS_HEADER_BASED_PRIORITY SETTINGS Parameter</a>
</h1>
<p id="rfc.section.4.1.p.1">To improve communication of the client&#8217;s intended prioritization scheme, this document specifies a new HTTP/2 SETTINGS parameter with the name <samp>SETTINGS_HEADER_BASED_PRIORITY</samp>. The value of the parameter MUST be 0 or 1; the initial value is 0. Frame-based prioritization is respected when the value is 0, or when the server does not recognize the setting.</p>
<p id="rfc.section.4.1.p.2">An HTTP/2 client that uses header-based priority SHOULD send a <samp>SETTINGS_HEADER_BASED_PRIORITY</samp> parameter with a value of 1 when connecting to a server.</p>
<p id="rfc.section.4.1.p.3">An intermediary SHOULD send a <samp>SETTINGS_HEADER_BASED_PRIORITY</samp> parameter with a value of 1 for a connection it establishes when, and only when, all the requests to be sent over that connection originate from a client that utilizes this header-based prioritization scheme. Otherwise this settings parameter SHOULD be set to 0.</p>
<p id="rfc.section.4.1.p.4">A client or intermediary MUST NOT send a <samp>SETTINGS_HEADER_BASED_PRIORITY</samp> parameter with the value of 0 after previously sending a value of 1.</p>
<p id="rfc.section.4.1.p.5">A server MUST NOT send a <samp>SETTINGS_HEADER_BASED_PRIORITY</samp> parameter. Upon receipt, a client that supports header-based prioritization MUST close the connection with a protocol error. Non-supporting clients will ignore this extension element (see <a href="#RFC7540" class="xref">[RFC7540]</a>, Section 5.5).</p>
<h1 id="rfc.section.5">
<a href="#rfc.section.5">5.</a> <a href="#considerations" id="considerations">Considerations</a>
</h1>
<h1 id="rfc.section.5.1">
<a href="#rfc.section.5.1">5.1.</a> <a href="#why-use-an-end-to-end-header-field" id="why-use-an-end-to-end-header-field">Why use an End-to-End Header Field?</a>
</h1>
<p id="rfc.section.5.1.p.1">Contrary to the prioritization scheme of HTTP/2 that uses a hop-by-hop frame, the Priority header field is defined as end-to-end.</p>
<p id="rfc.section.5.1.p.2">The rationale is that the Priority header field transmits how each response affects the client&#8217;s processing of those responses, rather than how relatively urgent each response is to others.  The way a client processes a response is a property associated to that client generating that request.  Not that of an intermediary.  Therefore, it is an end-to-end property.  How these end-to-end properties carried by the Priority header field affect the prioritization between the responses that share a connection is a hop-by-hop issue.</p>
<p id="rfc.section.5.1.p.3">Having the Priority header field defined as end-to-end is important for caching intermediaries.  Such intermediaries can cache the value of the Priority header field along with the response, and utilize the value of the cached header field when serving the cached response, only because the header field is defined as end-to-end rather than hop-by-hop.</p>
<p id="rfc.section.5.1.p.4">It should also be noted that the use of a header field carrying a textual value makes the prioritization scheme extensible; see the discussion below.</p>
<h1 id="rfc.section.5.2">
<a href="#rfc.section.5.2">5.2.</a> <a href="#why-do-urgencies-have-meanings" id="why-do-urgencies-have-meanings">Why do Urgencies Have Meanings?</a>
</h1>
<p id="rfc.section.5.2.p.1">One of the aims of this specification is to define a mechanism for merging client- and server-provided hints for prioritizing the responses.  For that to work, each urgency level needs to have a well-defined meaning.  As an example, a server can assign the highest precedence among the supplementary responses to an HTTP response carrying an icon, because the meaning of <samp>urgency=1</samp> is shared among the endpoints.</p>
<p id="rfc.section.5.2.p.2">This specification restricts itself to defining a minimum set of urgency levels in order to provide sufficient granularity for prioritizing responses for ordinary web browsing, at minimal complexity.</p>
<p id="rfc.section.5.2.p.3">However, that does not mean that the prioritization scheme would forever be stuck to the eight levels.  The design provides extensibility.  If deemed necessary, it would be possible to subdivide any of the eight urgency levels that are currently defined.  Or, a graphical user-agent could send a <samp>visible</samp> parameter to indicate if the resource being requested is within the viewport.</p>
<p id="rfc.section.5.2.p.4">A server can combine the hints provided in the Priority header field with other information in order to improve the prioritization of responses.  For example, a server that receives requests for a font <a href="#RFC8081" class="xref">[RFC8081]</a> and images with the same urgency might give higher precedence to the font, so that a visual client can render textual information at an early moment.</p>
<h1 id="rfc.section.5.3">
<a href="#rfc.section.5.3">5.3.</a> <a href="#reprioritization" id="reprioritization">Reprioritization</a>
</h1>
<p id="rfc.section.5.3.p.1">Once a client sends a request, it cannot reprioritize the corresponding response by using the Priority header field.  This is because an HTTP header field can only be sent as part of an HTTP message.</p>
<p id="rfc.section.5.3.p.2">Therefore, to support reprioritization, it is necessary to define a HTTP-version-dependent mechanism for transmitting the priority parameters.</p>
<p id="rfc.section.5.3.p.3">One approach that we can use in HTTP/2 (<a href="#RFC7540" class="xref">[RFC7540]</a>) is to use a frame that carries the priority parameters.</p>
<div id="rfc.figure.1"></div>
<div id="fig-reprioritization-frame"></div>
<pre>
  0                   1                   2                   3
  0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
 +---------------------------------------------------------------+
 |R|                        Stream ID (31)                       |
 +---------------------------------------------------------------+
 |                   Priority Field Value (*)                  ...
 +---------------------------------------------------------------+
</pre>
<p class="figure">Figure 1: Reprioritization frame payload</p>
<p id="rfc.section.5.3.p.4">The Reprioritization frame would be sent on stream 0.  This frame carries the stream ID of the response that is being reprioritized, and the updated priority in ASCII text, using the same represententation as that of the Priority header field value.</p>
<p id="rfc.section.5.3.p.5">As an example, a web browser might issue a prefetch request for an HTML on stream 31, with the urgency parameter of the Priority request header field set to <samp>background</samp>.  Then, when the user navigates to the HTML while prefetch is in action, it would send a reprioritization frame with the stream ID set to 31, and the priority field value set to <samp>urgency=0</samp>.</p>
<h1 id="rfc.section.6">
<a href="#rfc.section.6">6.</a> <a href="#security-considerations" id="security-considerations">Security Considerations</a>
</h1>
<p id="rfc.section.6.p.1">TBD</p>
<h1 id="rfc.section.7">
<a href="#rfc.section.7">7.</a> <a href="#iana-considerations" id="iana-considerations">IANA Considerations</a>
</h1>
<p id="rfc.section.7.p.1">This specification registers the following entry in the Permanent Message Header Field Names registry established by <a href="#RFC3864" class="xref">[RFC3864]</a>:</p>
<p></p>

<dl>
<dt>Header field name:</dt>
<dd style="margin-left: 8">Priority</dd>
<dt>Applicable protocol:</dt>
<dd style="margin-left: 8">http</dd>
<dt>Status:</dt>
<dd style="margin-left: 8">standard</dd>
<dt>Author/change controller:</dt>
<dd style="margin-left: 8">IETF</dd>
<dt>Specification document(s):</dt>
<dd style="margin-left: 8">This document</dd>
<dt>Related information:</dt>
<dd style="margin-left: 8">n/a</dd>
</dl>
<p id="rfc.section.7.p.3">This specification registers the following entry in the HTTP/2 Settings registry established by <a href="#RFC7540" class="xref">[RFC7540]</a>:</p>
<p></p>

<dl>
<dt>Name:</dt>
<dd style="margin-left: 8">SETTINGS_HEADER_BASED_PRIORITY:</dd>
<dt>Code:</dt>
<dd style="margin-left: 8">0xTBD</dd>
<dt>Initial value:</dt>
<dd style="margin-left: 8">0</dd>
<dt>Specification:</dt>
<dd style="margin-left: 8">This document</dd>
</dl>
<h1 id="rfc.references">
<a href="#rfc.references">8.</a> References</h1>
<h1 id="rfc.references.1">
<a href="#rfc.references.1">8.1.</a> Normative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC2119">[RFC2119]</b></td>
<td class="top">
<a>Bradner, S.</a>, "<a href="https://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, DOI 10.17487/RFC2119, March 1997.</td>
</tr>
<tr>
<td class="reference"><b id="RFC7230">[RFC7230]</b></td>
<td class="top">
<a>Fielding, R.</a> and <a>J. Reschke</a>, "<a href="https://tools.ietf.org/html/rfc7230">Hypertext Transfer Protocol (HTTP/1.1): Message Syntax and Routing</a>", RFC 7230, DOI 10.17487/RFC7230, June 2014.</td>
</tr>
<tr>
<td class="reference"><b id="RFC7540">[RFC7540]</b></td>
<td class="top">
<a>Belshe, M.</a>, <a>Peon, R.</a> and <a>M. Thomson</a>, "<a href="https://tools.ietf.org/html/rfc7540">Hypertext Transfer Protocol Version 2 (HTTP/2)</a>", RFC 7540, DOI 10.17487/RFC7540, May 2015.</td>
</tr>
<tr>
<td class="reference"><b id="STRUCTURED-HEADERS">[STRUCTURED-HEADERS]</b></td>
<td class="top">
<a>Nottingham, M.</a> and <a>P. Kamp</a>, "<a href="https://tools.ietf.org/html/draft-ietf-httpbis-header-structure-13">Structured Headers for HTTP</a>", Internet-Draft draft-ietf-httpbis-header-structure-13, August 2019.</td>
</tr>
</tbody></table>
<h1 id="rfc.references.2">
<a href="#rfc.references.2">8.2.</a> Informative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="I-D.ietf-quic-http">[I-D.ietf-quic-http]</b></td>
<td class="top">
<a>Bishop, M.</a>, "<a href="https://tools.ietf.org/html/draft-ietf-quic-http-23">Hypertext Transfer Protocol Version 3 (HTTP/3)</a>", Internet-Draft draft-ietf-quic-http-23, September 2019.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3864">[RFC3864]</b></td>
<td class="top">
<a>Klyne, G.</a>, <a>Nottingham, M.</a> and <a>J. Mogul</a>, "<a href="https://tools.ietf.org/html/rfc3864">Registration Procedures for Message Header Fields</a>", BCP 90, RFC 3864, DOI 10.17487/RFC3864, September 2004.</td>
</tr>
<tr>
<td class="reference"><b id="RFC8081">[RFC8081]</b></td>
<td class="top">
<a>Lilley, C.</a>, "<a href="https://tools.ietf.org/html/rfc8081">The "font" Top-Level Media Type</a>", RFC 8081, DOI 10.17487/RFC8081, February 2017.</td>
</tr>
</tbody></table>
<h1 id="rfc.appendix.A">
<a href="#rfc.appendix.A">Appendix A.</a> <a href="#acknowledgements" id="acknowledgements">Acknowledgements</a>
</h1>
<p id="rfc.section.A.p.1">Roy Fielding presented the idea of using a header field for representing priorities in <a href="http://tools.ietf.org/agenda/83/slides/slides-83-httpbis-5.pdf">http://tools.ietf.org/agenda/83/slides/slides-83-httpbis-5.pdf</a>.  In <a href="https://github.com/pmeenan/http3-prioritization-proposal">https://github.com/pmeenan/http3-prioritization-proposal</a>, Patrick Meenan advocates for representing the priorities using a tuple of urgency and concurrency.</p>
<p id="rfc.section.A.p.2">Many thanks to Robin Marx, Patrick Meenan and Ian Swett for their feedback.</p>
<h1 id="rfc.appendix.B">
<a href="#rfc.appendix.B">Appendix B.</a> <a href="#change-log" id="change-log">Change Log</a>
</h1>
<h1 id="rfc.appendix.B.1">
<a href="#rfc.appendix.B.1">B.1.</a> <a href="#since-draft-kazuho-httpbis-priority-02" id="since-draft-kazuho-httpbis-priority-02">Since draft-kazuho-httpbis-priority-02</a>
</h1>
<p></p>

<ul><li>TBD</li></ul>
<h1 id="rfc.appendix.B.2">
<a href="#rfc.appendix.B.2">B.2.</a> <a href="#since-draft-kazuho-httpbis-priority-01" id="since-draft-kazuho-httpbis-priority-01">Since draft-kazuho-httpbis-priority-01</a>
</h1>
<p></p>

<ul><li>Explain how reprioritization might be supported.</li></ul>
<h1 id="rfc.appendix.B.3">
<a href="#rfc.appendix.B.3">B.3.</a> <a href="#since-draft-kazuho-httpbis-priority-00" id="since-draft-kazuho-httpbis-priority-00">Since draft-kazuho-httpbis-priority-00</a>
</h1>
<p></p>

<ul><li>Expand urgency levels from 3 to 8.</li></ul>
<h1 id="rfc.authors"><a href="#rfc.authors">Authors' Addresses</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Kazuho Oku</span> 
	  <span class="n hidden">
		<span class="family-name">Oku</span>
	  </span>
	</span>
	<span class="org vcardline">Fastly</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality"></span> 
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline"></span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:kazuhooku@gmail.com">kazuhooku@gmail.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Lucas Pardue</span> 
	  <span class="n hidden">
		<span class="family-name">Pardue</span>
	  </span>
	</span>
	<span class="org vcardline">Cloudflare</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality"></span> 
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline"></span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:lucaspardue.24.7@gmail.com">lucaspardue.24.7@gmail.com</a></span>

  </address>
</div>

</body>
</html>

